#include "../../includes/miniRT.h"

/**
 *@brief ç”¨äºåˆ¤æ–­ä¸€ä¸ªå°„çº¿æ˜¯å¦ä¸ä¸€ä¸ªå¹³é¢ç›¸äº¤
 *denom æ˜¯å¹³é¢æ³•å‘é‡ä¸å°„çº¿æ–¹å‘çš„ç‚¹ç§¯ã€‚å¦‚æœä¸º 0ï¼Œè¯´æ˜å°„çº¿ä¸å¹³é¢å¹³è¡Œï¼Œä¸å¯èƒ½ç›¸äº¤ï¼›
 *p0l0 æ˜¯ä»å…‰çº¿èµ·ç‚¹æŒ‡å‘å¹³é¢ä¸Šä¸€ç‚¹çš„å‘é‡
 *t æ˜¯ç›¸äº¤è·ç¦»ï¼›
 â€¢	å¦‚æœ t > 0ï¼Œè¯´æ˜äº¤ç‚¹åœ¨æ‘„åƒæœºå‰æ–¹ï¼›
 â€¢	å¦‚æœ t < 0ï¼Œè¯´æ˜äº¤ç‚¹åœ¨æ‘„åƒæœºåé¢ï¼Œä¸å¯è§ã€‚
 * ç¬¬ä¸€å¤„ç‚¹ç§¯ï¼šdenom = vec3_dot(pl->normal, ray.direction);
 * ğŸ“Œ ç›®çš„ï¼šåˆ¤æ–­å°„çº¿æ˜¯å¦ä¸å¹³é¢å¹³è¡Œ
 */
int	hit_plane(t_ray ray, t_plane *pl, t_hit *hit)
{
	double	denom;
	t_vec3	p010;//ç”¨äºå­˜å‚¨ä»å…‰çº¿åŸç‚¹æŒ‡å‘å¹³é¢ä¸Šä¸€ç‚¹çš„æ–¹å‘å‘é‡
	double	t;//äº¤ç‚¹åœ¨å…‰çº¿ä¸Šçš„å‚æ•°
	
	denom = vec3_dot(pl->normal, ray.direction);
	if (fabs(denom) > 1e-6)//è¿™æ˜¯ç§‘å­¦è®¡æ•°æ³•ï¼Œè¡¨ç¤º 1 \times 10^{-6}ï¼Œå³ï¼š0.000001 ï¼ˆç”±äºæµ®ç‚¹æ•°è¿ç®—å¯èƒ½ä¸ä¼šç²¾ç¡®ç­‰äº 0ï¼ˆè€Œæ˜¯ä¸€ä¸ªéå¸¸æ¥è¿‘ 0 çš„å°æ•°ï¼‰ï¼‰æ˜¯â€œé¿å…é™¤ä»¥0çš„æŠ€å·§â€
	{
		//p010 = å¹³é¢ä¸Šçš„ç‚¹ - å…‰çº¿çš„èµ·ç‚¹;
		//è®¡ç®—ç»“æœæ˜¯ä¸€ä¸ªæ–¹å‘å‘é‡ï¼Œä¹Ÿå°±æ˜¯ï¼šä»å…‰çº¿èµ·ç‚¹æŒ‡å‘å¹³é¢çš„ä¸€ç‚¹ã€‚
		p010 = vec3_sub(pl->point, ray.origin);
		//ğŸ“Œ ç›®çš„ï¼šè®¡ç®—å°„çº¿ä¸å¹³é¢äº¤ç‚¹çš„å‚æ•° t
		//â€¢	p010 = pl->point - ray.origin è¡¨ç¤ºä»å…‰çº¿èµ·ç‚¹åˆ°å¹³é¢ä¸Šä»»æ„ä¸€ç‚¹çš„å‘é‡ã€‚
		t = vec3_dot(p010, pl->normal) / denom;
		if (t >= 0)
		{
			hit->t = t;
			hit->point = vec3_add(ray.origin, vec3_scale(ray.direction, t));
			hit->normal = vec3_normalize(pl->normal);
			hit->color = pl->color;
			return (1);
		}
	}
	return (0);
}
